<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analisador de Sentimentos</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 w-screen flex flex-col items-center min-h-screen">
    <div class="max-w-md w-lg h-max bg-white shadow-md rounded-lg p-6">
        <h1 class="text-xl font-semibold mb-4 text-center">Classificando os Sentimentos a partir dos arquivos</h1>
        <form class=" flex flex-col" action="/analisar_arquivo" method="post" enctype="multipart/form-data">
            <label for="file"
                class="text-center bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 w-full">Enviar
                Arquivo</label>
            <input type="file" name="file" id="file" class="hidden">
            <input type="submit" value="Analisar"
                class="mt-4 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 w-full">
        </form>
    </div>
    <div id="resultado"
        class="w-full h-screen hidden z-0 absolute flex justify-center items-center space-x-4 opacity-80 bg-black p-4 rounded-lg">
        <span class="bg-white w-5 h-5 opacity-1 rounded-full animate-bounce"></span>
        <span class="bg-white w-5 h-5 rounded-full animate-bounce"></span>
        <span class="bg-white w-5 h-5 rounded-full animate-bounce"></span>
    </div>


    <script>
        // Seleção dos elementos do DOM usados pelo script
        // - `form`: formulário que envia o arquivo para análise
        // - `resultado`: overlay de carregamento que cobre a tela enquanto a análise ocorre
        // - `spans`: três bolinhas que recebem animação visual de carregamento
        const form = document.querySelector("form");
        const resultado = document.getElementById("resultado");
        const spans = resultado.querySelectorAll("span");

        // Ao submeter o formulário, exibe o overlay de carregamento
        // e aplica animações às bolinhas para indicar atividade.
        form.addEventListener("submit", () => {
            // Remove a classe `hidden` para mostrar o overlay
            resultado.classList.remove("hidden");

            // Aplica a animação manualmente (sobrescreve classes CSS)
            spans.forEach((span) => {
                // Define a animação, duração e curva de aceleração
                span.style.animation = "bounce .6s cubic-bezier(0.6, 0.1, 1, 0.4)";
                // Faz a animação repetir indefinidamente
                span.style.animationIterationCount = "infinite";
                // Alterna a direção da animação a cada iteração
                span.style.animationDirection = "alternate";
            });

            // Adiciona pequenos delays nas primeiras bolinhas para criar o efeito em sequência
            spans[0].style.animationDelay = ".1s";
            spans[1].style.animationDelay = ".2s";

            // Intervalo que verifica periodicamente se a operação terminou.
            // A aplicação de backend deve definir um cookie `downloadFinalizado=1`
            // quando a análise / download estiver completo.
            const interval = setInterval(() => {
                if (document.cookie.includes("downloadFinalizado=1")) {
                    // Esconde o overlay quando o cookie é detectado
                    resultado.classList.add("hidden");

                    // Remove a animação das bolinhas para resetar o estado visual
                    spans.forEach(span => span.style.animation = "none");

                    // Limpa o intervalo para parar a verificação
                    clearInterval(interval);

                    // Remove o cookie limpando seu tempo de vida (max-age=0)
                    document.cookie = "downloadFinalizado=1; max-age=0;";
                }
            }, 300); // checa a cada 300ms
        });


        // Trata o evento `pageshow`, que é disparado quando a página é mostrada,
        // incluindo quando é restaurada do bfcache (back-forward cache).
        // Se `event.persisted` for true, a página veio do cache e devemos garantir
        // que o overlay de carregamento esteja oculto e que as animações estejam resetadas.
        window.addEventListener("pageshow", (event) => {
            if (event.persisted) {
                resultado.classList.add("hidden");

                // Garante que nenhuma animação antiga permaneça ativa
                spans.forEach(span => {
                    span.style.animation = "none";
                });
            }
        });
    </script>
</body>

</html>